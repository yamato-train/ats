<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>警笛・後吾テスト</title>
</head>
<body>
  <h1>警笛 / 後吾 再生テスト</h1>
  <p>
    <strong>Space</strong>：ATS起動<br>
    <strong>Enter</strong>：ATS確認<br>
    <strong>A</strong>：ATS停止
  </p>

  <!-- 音声ファイル -->
  <audio id="keiteki" src="keiteki.m4a"></audio>
  <audio id="kougo" src="kougo.m4a"></audio>

  <script>
    const keiteki = document.getElementById("keiteki");
    const kougo = document.getElementById("kougo");

    // 警笛はループさせておく（Space で再生開始）
    keiteki.loop = true;

    // キー押下の状態を管理（押しっぱなしで連打されないように）
    const keyState = {
      Space: false,
      Enter: false,
      KeyA: false
    };

    document.addEventListener("keydown", async (e) => {
      // 同じキーが押しっぱなしなら無視
      if (keyState[e.code]) return;
      keyState[e.code] = true;

      // Space：keiteki.m4a を連続再生
      if (e.code === "Space") {
        e.preventDefault();
        try {
          // 既に再生中なら何もしない
          if (keiteki.paused) {
            // 後吾が鳴ってたら止める
            kougo.pause();
            kougo.currentTime = 0;

            await keiteki.play(); // ループ再生開始
          }
        } catch (err) {
          console.error("再生エラー(Space):", err);
        }
      }

      // Enter：keiteki を止めて kougo 再生
      if (e.code === "Enter") {
        e.preventDefault();
        try {
          // 警笛を止める
          keiteki.pause();
          keiteki.currentTime = 0;

          // 後吾を頭から1回再生
          kougo.currentTime = 0;
          await kougo.play();
        } catch (err) {
          console.error("再生エラー(Enter):", err);
        }
      }

      // A：すべて停止
      if (e.code === "KeyA") {
        e.preventDefault();
        keiteki.pause();
        keiteki.currentTime = 0;
        kougo.pause();
        kougo.currentTime = 0;
      }
    });

    document.addEventListener("keyup", (e) => {
      if (keyState[e.code]) {
        keyState[e.code] = false;
      }
    });
  </script>
</body>
</html>
